<div class="container">

<div class="offer card">
    <div class="photo"><img src="<%=offer.picture.pic_path %>"></div>  
    <div class="offer-title">
        <div>
            <h2 class="card-title"><%= offer.title %></h2>
            <h4>ONG NAME POR AHORA<%= offer._ong.name %></h4>
        </div>
        <div class="badge">
            <span class="btn btn-primary btn-round"><%= offer.category %></span>
        </div>
    </div>
    <div class="offer-data">
        <h3>About</h3>
        <p><%= offer.about %></p>
        <h3>When & Where</h3>
        <span><%= offer.when %></span>
        <span><%= offer.where %></span>
        <h3>Requirements</h3>
        <span><%= offer.requirements %></span>
    </div>    
        <div class="button">
        <% if (role == 'user') { %>
            <% if (userStatus === true) { %>
                <button class="offerbutton subscribed btn btn-lg btn-danger">Unsusbcribe from this offer</button>
            <% } else { %>
                <button class="offerbutton btn btn-lg btn-primary">Join the Cause</button>
            <% } %>    
        <% } %>
        <% if (ongOwner === true) { %>
                <button class="offerbutton edit btn btn-primary btn-lg">Edit this offer</button>
        <% } %>
        </div>

    <% if (ongOwner === true) { %>
        <div class="all-users-subscribed">
        <% if (usersSubscribed.length > 0) { %>
            <% usersSubscribed.forEach((user) => { %>
                    <div style="border: 1px solid red; width: 80%; height: auto; margin: auto" class="user-subscribed">
                            <span><a href="/<%=user._id%>"><%= user.name %></a></span>
                            <span><%= user.surname %></span>
                            <span><%= user.email %></span>
                            <span>Address:</span>
                            <span><%= user.address.street %></span>
                            <span><%= user.address.city %></span>
                            <span><%= user.address.state %></span>
                            <span><%= user.address.zip %></span>
                    </div>
            <% }); %>
        <% } %>
        </div>
    <% } %>    
  </div>
</div>  
  
  
  <script>
  $(document).ready(function(){
    $('.btn').on('click', (event) => {
        console.log('click')
        if ($('.btn').hasClass('btn-danger')) {
            //hacer peticion POST a 'offerid/unsubscribe'
            $.ajax({
                method:  'POST',
                url:     "/offer/<%= offer._id %>/unsubscribe",
                success: showFeedback,
                error:   handleError,
            });
        $('.btn').removeClass('btn-danger').addClass('btn-primary').text('Join the Cause');    
        }
        else {
            // hacer peticion post a offerid/subscribe
            $.ajax({
                method:  'POST',
                url:     "/offer/<%= offer._id%>/subscribe",
            //   success: showFeedback,
            //   error:   handleError
            });
        $('.btn').removeClass('btn-primary').addClass('btn-danger').text('Unsusbcribe from this offer');    
        }
        function showFeedback () {
            alert('You have suscribed to this offer. Thank you!')
        }
        
        function handleError (err) {
            console.log('Oh no! Error:');
            console.log(err);
            alert('We are sorry, there was a mistake')
        }   
    });
});
</script>
